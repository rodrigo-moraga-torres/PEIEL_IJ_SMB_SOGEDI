library(readxl)
library(writexl)
library(dplyr)
library(psych)
library(lavaan)
if (! require("pacman")) install.packages("pacman")
pacman::p_load(tidyverse,
sjmisc,
here,
sjlabelled,
haven,
naniar,
car,
kableExtra)
options(scipen=999)
rm(list = ls())
sogedi_db <- haven::read_sav(url("https://github.com/sogedi-project/sogedi-data/raw/refs/heads/main/input/data/original/SOGEDI_dataset_V1.sav"), user_na = T)
glimpse(sogedi_db)
#Seleccionar
db_proc <- sogedi_db %>%
dplyr::select(-c(matches("^(aten|time)"), 247:269, 283))
#Filtro paises con poder estadístico (ARG, CHI, COL, Esp y MEX)
frq(db_proc$natio_recoded)
#Dejarsolo Chile
db_chile <- db_proc %>%
dplyr::filter(natio_recoded %in% c(3))
db_proc %>%
select(-c(ex_we_1, ex_we_2, in_we_1, in_we_2,
ex_po_1, ex_po_2, in_po_1, in_po_2,
matches("^(greedy|punish|carin)"))) %>%
miss_var_summary(.) %>%
filter(pct_miss > 0) %>%
kable(.,"markdown")
writexl::write_xlsx(
db_chile,
path = here::here("output", "db_chile.xlsx")
)
dir.create("output", showWarnings = FALSE)
writexl::write_xlsx(
db_chile,
path = "~/Desktop/db_chile.xlsx"
)
here::here("output", "db_chile.xlsx")
here::here("output", "db_chile.xlsx")
writexl::write_xlsx(
db_chile,
path = here::here("output", "db_chile.xlsx")
)
writexl::write_xlsx(
db_chile,
path = here::here("output", "db_chile.xlsx")
)
modelo_latente_chile <- "
# Medición
ECO_IN =~ eco_in_1 + eco_in_2 + eco_in_3
MOBI_UP =~ mobi_up_1 + mobi_up_2 + mobi_up_3
MOBI_DOWN =~ mobi_down_1 + mobi_down_2 + mobi_down_3
# Relaciones estructurales
MOBI_UP ~ a1*ECO_IN
MOBI_DOWN ~ d1*ECO_IN + a2*MOBI_UP
jus_ine ~ b1*MOBI_UP + b2*MOBI_DOWN + c_pr*ECO_IN
# Efectos indirectos
ind1 := a1*b1
ind2 := d1*b2
ind3 := a1*a2*b2
total_ind := ind1 + ind2 + ind3
# Efecto total
total := c_pr + total_ind
# Proporción mediada
prop_mediada := (total_ind / total) * 100
"
ajuste_latente_chile <- sem(modelo_latente_chile,
ordered = colnames(db_chile),
estimator="DWLS",
data = db_chile,
se = "bootstrap",
bootstrap = 5000)
#Solo ARG, CHI, COL, Esp y MEX
db_proc <- db_proc %>%
dplyr::filter(natio_recoded %in% c(1,3,4,9,13))
modelo_latente_chile <- "
# Medición
ECO_IN =~ eco_in_1 + eco_in_2 + eco_in_3
MOBI_UP =~ mobi_up_1 + mobi_up_2 + mobi_up_3
MOBI_DOWN =~ mobi_down_1 + mobi_down_2 + mobi_down_3
# Relaciones estructurales
MOBI_UP ~ a1*ECO_IN
MOBI_DOWN ~ d1*ECO_IN + a2*MOBI_UP
jus_ine ~ b1*MOBI_UP + b2*MOBI_DOWN + c_pr*ECO_IN
# Efectos indirectos
ind1 := a1*b1
ind2 := d1*b2
ind3 := a1*a2*b2
total_ind := ind1 + ind2 + ind3
# Efecto total
total := c_pr + total_ind
# Proporción mediada
prop_mediada := (total_ind / total) * 100
"
modelo_latente_chile <- "
# Medición
ECO_IN =~ eco_in_1 + eco_in_2 + eco_in_3
MOBI_UP =~ mobi_up_1 + mobi_up_2 + mobi_up_3
MOBI_DOWN =~ mobi_down_1 + mobi_down_2 + mobi_down_3
# Relaciones estructurales
MOBI_UP ~ a1*ECO_IN
MOBI_DOWN ~ d1*ECO_IN + a2*MOBI_UP
jus_ine ~ b1*MOBI_UP + b2*MOBI_DOWN + c_pr*ECO_IN
# Efectos indirectos
ind1 := a1*b1
ind2 := d1*b2
ind3 := a1*a2*b2
total_ind := ind1 + ind2 + ind3
# Efecto total
total := c_pr + total_ind
# Proporción mediada
prop_mediada := (total_ind / total) * 100
"
ajuste_latente_chile <- sem(modelo_latente_chile,
ordered = colnames(db_chile),
estimator="DWLS",
data = db_chile,
se = "bootstrap",
bootstrap = 5000)
summary(ajuste_latente_chile, fit.measures = TRUE, standardized = TRUE, rsquare = TRUE)
parameterEstimates(
ajuste_latente_1,
standardized = TRUE,
ci = TRUE,
boot.ci.type = "perc"
) %>%
dplyr::filter(grepl("ind|total|prop", label))
parameterEstimates(
ajuste_latente_chile,
standardized = TRUE,
ci = TRUE,
boot.ci.type = "perc"
) %>%
dplyr::filter(grepl("ind|total|prop", label))
parameterEstimates(
ajuste_latente_chile,
standardized = TRUE,
ci = TRUE,
boot.ci.type = "perc"
) %>%
dplyr::filter(grepl("ind|total|prop", label))
modelo_latente_SOGEDI <- "
# Medición
ECO_IN =~ eco_in_1 + eco_in_2 + eco_in_3
MOBI_UP =~ mobi_up_1 + mobi_up_2 + mobi_up_3
MOBI_DOWN =~ mobi_down_1 + mobi_down_2 + mobi_down_3
# Relaciones estructurales
MOBI_UP ~ a1*ECO_IN
MOBI_DOWN ~ d1*ECO_IN + a2*MOBI_UP
jus_ine ~ b1*MOBI_UP + b2*MOBI_DOWN + c_pr*ECO_IN
# Efectos indirectos
ind1 := a1*b1
ind2 := d1*b2
ind3 := a1*a2*b2
total_ind := ind1 + ind2 + ind3
# Efecto total
total := c_pr + total_ind
# Proporción mediada
prop_mediada := (total_ind / total) * 100
"
ajuste_latente_SOGEDI <- sem(modelo_latente_SOGEDI,
ordered = colnames(db_proc),
estimator="DWLS",
data = db_proc,
se = "bootstrap",
bootstrap = 5000)
summary(ajuste_latente_SOGEDI, fit.measures = TRUE, standardized = TRUE, rsquare = TRUE)
parameterEstimates(
ajuste_latente_SOGEDI,
standardized = TRUE,
ci = TRUE,
boot.ci.type = "perc"
) %>%
dplyr::filter(grepl("ind|total|prop", label))
tabla_chile <- parameterEstimates(
ajuste_latente_chile,
standardized = TRUE,
ci = TRUE,
boot.ci.type = "perc"
) %>%
dplyr::filter(grepl("ind|total|prop", label))
parameterEstimates(
ajuste_latente_chile,
standardized = TRUE,
ci = TRUE,
boot.ci.type = "perc"
) %>%
dplyr::filter(grepl("ind|total|prop", label))
# Exportar tabla resultados Chile
tabla_chile <- parameterEstimates(
ajuste_latente_chile,
standardized = TRUE,
ci = TRUE,
boot.ci.type = "perc"
) %>%
dplyr::filter(grepl("ind|total|prop", label))
parameterEstimates(
ajuste_latente_SOGEDI,
standardized = TRUE,
ci = TRUE,
boot.ci.type = "perc"
) %>%
dplyr::filter(grepl("ind|total|prop", label))
# Exportar Tabla resultados SOGEDI
tabla_sogedi <- parameterEstimates(
ajuste_latente_SOGEDI,
standardized = TRUE,
ci = TRUE,
boot.ci.type = "perc"
) %>%
dplyr::filter(grepl("ind|total|prop", label))
# Crear carpeta si no existe
dir.create("output", showWarnings = FALSE)
# Exportar ambas tablas en un solo archivo Excel
writexl::write_xlsx(
list(
"Resultados Chile" = tabla_chile,
"Resultados SOGEDI" = tabla_sogedi
),
path = here::here("output", paste0("Resultados_SEM_", Sys.Date(), ".xlsx"))
)
library(lavaan)
library(semPlot)
semPaths(
ajuste_latente_chile,
what = "std",          # muestra coeficientes estandarizados
layout = "tree",       # disposición jerárquica
style = "lisrel",      # estilo clásico SEM
residuals = FALSE,     # oculta varianzas residuales si quieres simplificar
intercepts = FALSE,    # oculta interceptos
edge.label.cex = 1,    # tamaño de los coeficientes
sizeMan = 6,           # tamaño de nodos observados
sizeLat = 9,           # tamaño de nodos latentes
nCharNodes = 0,        # muestra nombres completos
curvePivot = TRUE,     # mejora la curvatura de flechas
title = FALSE
)
semPaths(
ajuste_latente_chile,
what = "std",
layout = "tree",
style = "ram",          # solo muestra relaciones entre latentes
nCharNodes = 0,
edge.label.cex = 1.2,
residuals = FALSE,
intercepts = FALSE,
title = FALSE
)
library(ggplot2)
library(ggplot2)
# Extraer efectos definidos
efectos <- parameterEstimates(ajuste_latente_chile) %>%
dplyr::filter(label %in% c("ind1", "ind2", "ind3", "total_ind", "total")) %>%
dplyr::mutate(label = factor(label,
levels = c("ind1","ind2","ind3","total_ind","total"),
labels = c("Indirecto 1", "Indirecto 2", "Indirecto 3",
"Total Indirecto", "Total Efecto")))
# Gráfico de barras
ggplot(efectos, aes(x = label, y = est, fill = label)) +
geom_bar(stat = "identity") +
geom_errorbar(aes(ymin = ci.lower, ymax = ci.upper), width = 0.2) +
labs(x = "", y = "Efecto estandarizado", title = "Efectos de mediación - Modelo Chile") +
theme_minimal() +
theme(legend.position = "none")
library(DiagrammeR)
grViz("
digraph sem {
graph [layout = dot, rankdir = LR]
node [shape = rectangle, style=filled, fillcolor=lightblue, fontsize=12]
ECO_IN [label='Desigualdad Económica Percibida (ECO_IN)']
MOBI_UP [label='Movilidad Ascendente (MOBI_UP)']
MOBI_DOWN [label='Movilidad Descendente (MOBI_DOWN)']
jus_ine [label='Evaluación de Injusticia (jus_ine)']
ECO_IN -> MOBI_UP [label='a1 = 0.17***']
MOBI_UP -> jus_ine [label='b1 = 0.24***']
ECO_IN -> MOBI_DOWN [label='d1 = -0.02 ns']
MOBI_UP -> MOBI_DOWN [label='a2 = -0.30***']
MOBI_DOWN -> jus_ine [label='b2 = -0.00 ns']
ECO_IN -> jus_ine [label='c\' = -0.23***']
}
")
grViz("
digraph sem {
graph [layout = dot, rankdir = LR]
node [shape = rectangle, style=filled, fillcolor=lightblue, fontsize=12]
ECO_IN [label='Desigualdad Económica Percibida (ECO_IN)']
MOBI_UP [label='Movilidad Ascendente (MOBI_UP)']
MOBI_DOWN [label='Movilidad Descendente (MOBI_DOWN)']
jus_ine [label='Evaluación de Injusticia (jus_ine)']
ECO_IN -> MOBI_UP [label='a1 = 0.17***']
MOBI_UP -> jus_ine [label='b1 = 0.24***']
ECO_IN -> MOBI_DOWN [label='d1 = -0.02 ns']
MOBI_UP -> MOBI_DOWN [label='a2 = -0.30***']
MOBI_DOWN -> jus_ine [label='b2 = -0.00 ns']
ECO_IN -> jus_ine [label='c’ = -0.23***']
}
")
grViz("
digraph sem {
graph [layout = dot, rankdir = LR]
node [shape = rectangle, style=filled, fillcolor=lightblue, fontsize=12]
ECO_IN [label='Desigualdad Económica Percibida (ECO_IN)']
MOBI_UP [label='Movilidad Ascendente (MOBI_UP)']
jus_ine [label='Evaluación de Injusticia (jus_ine)']
ECO_IN -> MOBI_UP [label='a1 = 0.17***']
MOBI_UP -> jus_ine [label='b1 = 0.24***']
ECO_IN -> jus_ine [label='c’ = -0.23***']
}
")
grViz("
digraph sem {
graph [layout = dot, rankdir = LR]
node [shape = rectangle, style=filled, fillcolor=lightblue, fontsize=12]
ECO_IN [label='Desigualdad Económica Percibida (ECO_IN)']
MOBI_UP [label='Movilidad Ascendente (MOBI_UP)']
MOBI_DOWN [label='Movilidad Descendente (MOBI_DOWN)']
jus_ine [label='Evaluación de Injusticia (jus_ine)']
ECO_IN -> MOBI_UP [label='a1 = 0.17***']
MOBI_UP -> jus_ine [label='b1 = 0.24***']
ECO_IN -> MOBI_DOWN [label='d1 = -0.02 ns']
MOBI_UP -> MOBI_DOWN [label='a2 = -0.30***']
MOBI_DOWN -> jus_ine [label='b2 = -0.00 ns']
ECO_IN -> jus_ine [label='c’ = -0.23***']
}
")
# Extrae los coeficientes estructurales del modelo SOGEDI
coef_sogedi <- parameterEstimates(ajuste_latente_SOGEDI, standardized = TRUE) %>%
dplyr::filter(op == "~") %>%
dplyr::select(lhs, rhs, est, pvalue, std.all)
coef_sogedi
# Extrae los coeficientes estructurales del modelo SOGEDI
coef_sogedi <- parameterEstimates(ajuste_latente_SOGEDI, standardized = TRUE) %>%
dplyr::filter(op == "~") %>%
dplyr::select(lhs, rhs, est, pvalue, std.all)
grViz("
digraph sem {
graph [layout = dot, rankdir = LR]
node [shape = rectangle, style=filled, fillcolor=lightblue, fontsize=12]
ECO_IN [label='Desigualdad Económica Percibida (ECO_IN)']
MOBI_UP [label='Movilidad Ascendente (MOBI_UP)']
MOBI_DOWN [label='Movilidad Descendente (MOBI_DOWN)']
jus_ine [label='Evaluación de Injusticia (jus_ine)']
ECO_IN -> MOBI_UP [label='a1 = 0.16***']
MOBI_UP -> jus_ine [label='b1 = 0.14***']
ECO_IN -> MOBI_DOWN [label='d1 = 0.09***']
MOBI_UP -> MOBI_DOWN [label='a2 = -0.39***']
MOBI_DOWN -> jus_ine [label='b2 = 0.03 ns']
ECO_IN -> jus_ine [label='c’ = -0.14***']
}
")
library(DiagrammeRsvg)
library(rsvg)
if(!require(DiagrammeRsvg)) install.packages("DiagrammeRsvg")
if(!require(DiagrammeRsvg)) install.packages("DiagrammeRsvg")
if(!require(rsvg)) install.packages("rsvg")
library(DiagrammeRsvg)
library(rsvg)
grafico_chile <- grViz("
digraph sem {
graph [layout = dot, rankdir = LR]
node [shape = rectangle, style=filled, fillcolor='#C9E4F2', fontsize=12]
ECO_IN [label='Desigualdad Económica Percibida (ECO_IN)']
MOBI_UP [label='Movilidad Ascendente (MOBI_UP)']
MOBI_DOWN [label='Movilidad Descendente (MOBI_DOWN)']
jus_ine [label='Evaluación de Injusticia (jus_ine)']
ECO_IN -> MOBI_UP [label='a1 = 0.17***']
MOBI_UP -> jus_ine [label='b1 = 0.24***']
ECO_IN -> MOBI_DOWN [label='d1 = -0.02 ns']
MOBI_UP -> MOBI_DOWN [label='a2 = -0.30***']
MOBI_DOWN -> jus_ine [label='b2 = -0.00 ns']
ECO_IN -> jus_ine [label='c’ = -0.23***']
}
")
# Exportar Chile
svg_chile <- export_svg(grafico_chile)
rsvg_png(svg_chile, file = "output/figuras/modelo_mediacion_Chile.png")
grafico_chile <- grViz("
digraph sem {
graph [layout = dot, rankdir = LR]
node [shape = rectangle, style=filled, fillcolor='#C9E4F2', fontsize=12]
ECO_IN [label='Desigualdad Económica Percibida (ECO_IN)']
MOBI_UP [label='Movilidad Ascendente (MOBI_UP)']
MOBI_DOWN [label='Movilidad Descendente (MOBI_DOWN)']
jus_ine [label='Evaluación de Injusticia (jus_ine)']
ECO_IN -> MOBI_UP [label='a1 = 0.17***']
MOBI_UP -> jus_ine [label='b1 = 0.24***']
ECO_IN -> MOBI_DOWN [label='d1 = -0.02 ns']
MOBI_UP -> MOBI_DOWN [label='a2 = -0.30***']
MOBI_DOWN -> jus_ine [label='b2 = -0.00 ns']
ECO_IN -> jus_ine [label='c’ = -0.23***']
}
")
# Exportar Chile
svg_chile <- export_svg(grafico_chile)
rsvg_png(svg_chile, file = "output/modelo_mediacion_Chile.png")
grafico_chile <- grViz("
digraph sem {
graph [layout = dot, rankdir = LR]
node [shape = rectangle, style=filled, fillcolor='#C9E4F2', fontsize=12]
ECO_IN [label='Desigualdad Económica Percibida (ECO_IN)']
MOBI_UP [label='Movilidad Ascendente (MOBI_UP)']
MOBI_DOWN [label='Movilidad Descendente (MOBI_DOWN)']
jus_ine [label='Evaluación de Injusticia (jus_ine)']
ECO_IN -> MOBI_UP [label='a1 = 0.17***']
MOBI_UP -> jus_ine [label='b1 = 0.24***']
ECO_IN -> MOBI_DOWN [label='d1 = -0.02 ns']
MOBI_UP -> MOBI_DOWN [label='a2 = -0.30***']
MOBI_DOWN -> jus_ine [label='b2 = -0.00 ns']
ECO_IN -> jus_ine [label='c’ = -0.23***']
}
")
# Exportar Chile
svg_chile <- export_svg(grafico_chile)
rsvg_png(charToRaw(svg_chile), file = "output/modelo_mediacion_Chile.png")
rsvg_pdf(charToRaw(svg_chile), file = "output/modelo_mediacion_Chile.pdf")
")
grafico_sogedi <- grViz("
digraph sem {
grafico_sogedi <- grViz("
digraph sem {
graph [layout = dot, rankdir = LR]
node [shape = rectangle, style=filled, fillcolor='#D9D9D9', fontsize=12]
ECO_IN [label='Desigualdad Económica Percibida (ECO_IN)']
MOBI_UP [label='Movilidad Ascendente (MOBI_UP)']
MOBI_DOWN [label='Movilidad Descendente (MOBI_DOWN)']
jus_ine [label='Evaluación de Injusticia (jus_ine)']
ECO_IN -> MOBI_UP [label='a1 = 0.16***']
MOBI_UP -> jus_ine [label='b1 = 0.14***']
ECO_IN -> MOBI_DOWN [label='d1 = 0.09***']
MOBI_UP -> MOBI_DOWN [label='a2 = -0.39***']
MOBI_DOWN -> jus_ine [label='b2 = 0.03 ns']
ECO_IN -> jus_ine [label='c’ = -0.14***']
}
")
# Exportar SOGEDI
svg_sogedi <- export_svg(grafico_sogedi)
rsvg_png(charToRaw(svg_sogedi), file = "output/modelo_mediacion_SOGEDI.png")
summary(ajuste_latente_chile, fit.measures = TRUE, standardized = TRUE, rsquare = TRUE)
library(readxl)
library(writexl)
library(dplyr)
library(psych)
library(lavaan)
library(semPlot)
library(ggplot2)
library(DiagrammeR)
library(DiagrammeRsvg)
library(rsvg)
summary(ajuste_latente_chile, fit.measures = TRUE, standardized = TRUE, rsquare = TRUE)
parameterEstimates(
ajuste_latente_chile,
standardized = TRUE,
ci = TRUE,
boot.ci.type = "perc"
) %>%
dplyr::filter(grepl("ind|total|prop", label))
summary(ajuste_latente_SOGEDI, fit.measures = TRUE, standardized = TRUE, rsquare = TRUE)
parameterEstimates(
ajuste_latente_SOGEDI,
standardized = TRUE,
ci = TRUE,
boot.ci.type = "perc"
) %>%
dplyr::filter(grepl("ind|total|prop", label))
